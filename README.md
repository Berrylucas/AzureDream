# Azure Dream Schedule

本文档是AzureDream（以下简称AD）的开发计划文档，旨在规划项目进程，以及说明项目各方面的配置参数

项目网址：[azureDream](http://azuredream.info/)

主要技术：H5+CSS3+JS+Nodejs+express+multer+mysql

### 项目展示

##### 主页

<img src="img\home01.png" alt="home01" style="zoom: 80%;" />

点击左侧分类导航栏，即可查看上传的文档列表（部分功能未实现~）

<img src="img\home03.png" alt="home03" style="zoom:80%;" />

查看该类文档列表

<img src="img\home02.png" alt="home02" style="zoom:80%;" />

点击列表中的某文档，即可查看文档内容

##### 管理登录页

<img src="img\login.png" alt="login" style="zoom: 80%;" />

在此可以登录到管理页面，也实现了token自动登录机制

##### 管理页

<img src="img\manager01.png" alt="manager01" style="zoom:80%;" />

简易管理端页面，通过上面按钮对文档进行相应操作

<img src="img\manager02.png" alt="manager02" style="zoom:80%;" />

在此可以上传文件

### 需求分析

---

AD是一个个人网站开发项目，目的是可以分享编程学习知识、读书心得收集、个人情感创作，其次是锻炼开发能力；下面通过用户故事和用例建模来比较明确的展示项目

##### 用户故事

1. 我作为站长，可以将自己的编程学习笔记上传，以便于知识分享和温故知新
2. 我作为站长，可以将自己的读书笔记上传，以便于知识分享和自我回顾
3. 我作为站长，可以将自己的作品（文档或图片）上传，以便分享和自我检视
4. 我作为浏览者，可以查看站长上传展示的任何内容，以便于可以获取知识
5. 我作为浏览者，可以和网站上的AI对话，以便于了解站长是个什么样的人
6. 我作为管理者，可以将想要上传到服务器的东西方便上传，以便节省时间和精力

##### 用例图设计

用例图包含三元素：参与者、用例、子系统，四关系：关联、泛化（继承）、包含、扩展

<img src="img\azureDream.jpg" alt="azureDream" style="zoom:80%;" />

### 环境配置

开发环境windows10，部署环境ubuntu

==dev环境==

```shell
PS C:\Users\Qiuw> node --version
v19.0.0
PS C:\Users\Qiuw> yarn --version
1.22.19
```

项目所需包版本都在项目package.json文件中标明

```json
{
  "name": "ad",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "start": "node ./bin/www",
    "devstart": "nodemon ./bin/www"
  },
  "dependencies": {
    "cookie-parser": "~1.4.4",
    "crypto": "^1.0.1",
    "debug": "~2.6.9",
    "ejs": "^3.1.8",
    "express": "~4.16.1",
    "express-jwt": "^8.4.1",
    "http-errors": "~1.6.3",
    "jsonwebtoken": "^9.0.0",
    "morgan": "~1.9.1",
    "multer": "^1.4.5-lts.1",
    "mysql": "^2.18.1"
  }
}
```

数据库版本：mysql 8.0

==部署环境==

ubuntu服务器使用docker，并使用如下的镜像版本搭建运行环境

### 开发阶段

---

本次项目开发采用敏捷开发模型，总分5个迭代

在每个迭代中都会明确当前的任务，以及给出解决任务相应的前端设计、数据库设计、类图&时序图&状态图设计、接口设计，以便回顾和将来的维护

#### @Problems

> 项目开发十天左右，至目前2023/3/11，有如下bug和不足

##### @Bug

| 问题                                   | 说明                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| 管理页跨页多选                         | 后端管理页不能跨页多选                                       |
| 管理页上传文件表单重置不成功           | form.reset()并没有运行成功，猜测是在表单序列化后修改了原始数据 |
| home页请求包含图片的文档，所有图片丢失 | 因为本人笔记全部使用md文档，而本地笔记的图片引用放置到服务器上就会出现引用错误 |
| 管理页第一页未铺满                     | 当第一页不足7条时元素尺寸出现问题                            |

##### 不足

| 问题                                 | 说明                       |
| ------------------------------------ | -------------------------- |
| 管理页上传图片、home页展示功能未实现 | 该功能尚未完成             |
| 点击笔记展示渲染过于僵硬             | 未添加过渡动画             |
| 笔记展示格式不便观看                 | 过于简陋，对阅读并不友好   |
| AI， Search功能未实现                | AI算法和Search功能还未实现 |

#### 迭代一

##### Tasks

| Task           | Explain                                      |
| -------------- | -------------------------------------------- |
| 基本前端页面   | HTML页面结构：文档展示、AI分区基本雏形的编写 |
| 后端服务器搭建 | 后端服务可以正常运行，测试基本请求通过       |

1. H5+JS实现基本的前端页面

2. nodejs+express框架搭建完成基本页面的返回
3. 编写数据请求接口

##### 数据库设计

使用mysql数据库，总计使用2张表

==content_text表==

主要说明文章文件和路径关系，设计字段和说明如下

| 字段         | 值       | 说明                               |
| ------------ | -------- | ---------------------------------- |
| id           | 自增     | 表示内容编号                       |
| content_type | 1, 2, 3  | 1表示se，2表示notes，3表示creation |
| path         | varchar  | 表示存储该文件的路径               |
| name         | varchar  | 文章名                             |
| create_time  | datetime | 文章上传时间                       |
| section      | varchar  | 以@分隔的标签，供搜索分区用        |
| is_hidden    | -1, 0 ,1 | 分别表删除、展示、隐藏             |

==image表==

说明图片文件、路径、图片说明的关系，设计字段和说明如下

| 字段        | 值       | 说明                   |
| ----------- | -------- | ---------------------- |
| id          | int自增  | 表示文件编号           |
| name        | varchar  | 图片名                 |
| path        | varchar  | 图片路径               |
| description | varchar  | 图片描述               |
| create_time | datetimi | 创建时间               |
| is_hidden   | -1, 0 ,1 | 分别表删除、展示、隐藏 |

##### 问题和解决

==nodejs链接mysql==

报错ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol request

`更改密码解决`

```mysql
use mysql; 
alter user 'root'@'localhost'identified with mysql_native_password by '密码';
//重启
flush privileges;
```

#### 迭代二

##### Tasks

| Task                     | Explain                                          |
| ------------------------ | ------------------------------------------------ |
| 后端文档存储             | 后端可以存储和管理上传的文档                     |
| 前端对后端文档查询和请求 | 前端展示后端的文档列表并且可以发送对某文档的请求 |
| 后端文档服务             | 后端提供对文档请求的响应并正常给与资源           |

1. 构建简易管理端，实现上传、删除、隐藏、展示功能
2. 使用multer上传文件

#### 迭代三

##### Tasks

| Task             | Explain                                |
| ---------------- | -------------------------------------- |
| 支持MarkDown文档 | 可以支持MarkDown文档存储和前端页面解析 |
| 支持图片         | 可以支持图片存储和在前端展示           |

1. marked.js解析文档，highlight.js高亮
2. 图片未支持

#### 迭代四

##### Tasks

| Task         | Explain                                    |
| ------------ | ------------------------------------------ |
| 支持pdf文档  | 可以支持pdf文档存储和页面展示              |
| 展示页面美化 | 美化页面结构，可以在前端添加用户体验的部件 |

#### 迭代五

##### Tasks

| Task          | Explain              |
| ------------- | -------------------- |
| 管理员后端    | 提高网站页面管理能力 |
| AI【Qiu】开发 | 提升用户体验感       |
